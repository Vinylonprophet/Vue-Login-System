# PDF动态目录和序号生成功能

## 修改概述

本次修改实现了PDF导出时根据用户选中的图表动态生成目录和章节序号的功能，解决了只选择部分图表时目录和序号不匹配的问题。

## 主要修改文件

### 1. `src/services/DataAnalysis/aiService.ts`
**新增功能：**
- `generateDynamicTableOfContents()`: 动态生成论文目录
- `getDynamicSectionTitle()`: 获取动态章节标题（带序号）
- 修改 `getAcademicSectionTitle()`: 支持动态序号
- 修改 `getAcademicAnalysis()`: 支持动态章节标题

**核心特性：**
- 根据选中图表数量自动调整页码
- 章节序号从4.1、4.2...动态调整
- 只显示选中图表对应的分析章节

### 2. `src/services/DataAnalysis/exportService.ts`
**修改功能：**
- `createPDFContent()`: 使用动态生成的目录替换固定目录
- `addChartSectionToPDF()`: 使用动态章节标题
- `addFailedChartSectionToPDF()`: 支持动态序号
- `processChartsForPDF()`: 传递选中图表ID给AI分析

**改进点：**
- 标题页显示实际选中的分析方法数量
- 目录页码根据实际内容动态计算
- 图表分析章节使用正确的序号

### 3. `src/views/DataAnalysis.vue`
**更新内容：**
- `getAcademicAnalysis()`: 调用AIService方法而非本地重复实现
- 简化代码，避免重复逻辑

## 功能演示

### 选择全部图表时：
```
目录
1. 研究背景与意义 ......................................................... 3
2. 研究方法与数据来源 .................................................... 4
3. 评价体系构建与算法优化 ............................................... 5
4. 实证分析结果 ......................................................... 6
  4.1 遗传算法适应度变化曲线分析 ................................... 7
  4.2 IP评分分布图分析 ............................................. 8
  4.3 关键指标权重雷达图分析 ....................................... 9
  4.4 神经网络训练损失曲线分析 ..................................... 10
  4.5 特征重要性分析图分析 ......................................... 11
  4.6 SHAP特征贡献度分析图分析 .................................... 12
  4.7 PCA主成分降维图分析 ......................................... 13
  4.8 高级聚类分析图分析 ........................................... 14
5. 品牌塑造路径设计 ..................................................... 15
6. 政策建议与实践指导 ................................................... 16
7. 结论与展望 .......................................................... 17
```

### 只选择适应度和评分图表时：
```
目录
1. 研究背景与意义 ......................................................... 3
2. 研究方法与数据来源 .................................................... 4
3. 评价体系构建与算法优化 ............................................... 5
4. 实证分析结果 ......................................................... 6
  4.1 遗传算法适应度变化曲线分析 ................................... 7
  4.2 IP评分分布图分析 ............................................. 8
5. 品牌塑造路径设计 ..................................................... 9
6. 政策建议与实践指导 ................................................... 10
7. 结论与展望 .......................................................... 11
```

## 技术实现要点

1. **动态页码计算**: 基于选中图表数量自动计算各章节页码
2. **序号自动调整**: 4.1、4.2序号根据实际图表顺序重新编号
3. **AI内容同步**: 章节标题和AI生成内容保持一致
4. **向后兼容**: 保留原有的固定序号作为后备方案

## 使用方式

1. 进行全面数据分析
2. 点击"导出PDF"按钮
3. 在图表选择对话框中选择需要的图表
4. 点击"导出PDF (X个图表)"
5. 生成的PDF将包含动态调整的目录和序号

## 优势

- ✅ 目录与内容完全匹配
- ✅ 章节序号连续且正确
- ✅ 页码自动计算
- ✅ AI分析内容针对性强
- ✅ 论文结构更加规范 